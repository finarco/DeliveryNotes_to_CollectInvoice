{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h4 class="mb-0">Partneri</h4>
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPartnerModal">+ Pridať partnera</button>
</div>
<div class="modal fade" id="addPartnerModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form method="post">
        <div class="modal-header">
          <h5 class="modal-title">Nový partner</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Názov partnera</label>
              <input class="form-control" name="name" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Email</label>
              <input class="form-control" name="email">
            </div>
            <div class="col-md-4">
              <label class="form-label">Telefón</label>
              <input class="form-control" name="phone">
            </div>
            <div class="col-md-3">
              <label class="form-label">Ulica</label>
              <input class="form-control" name="street">
            </div>
            <div class="col-md-2">
              <label class="form-label">Číslo</label>
              <input class="form-control" name="street_number">
            </div>
            <div class="col-md-2">
              <label class="form-label">PSČ</label>
              <input class="form-control" name="postal_code">
            </div>
            <div class="col-md-3">
              <label class="form-label">Mesto</label>
              <input class="form-control" name="city">
            </div>
            <div class="col-md-2">
              <label class="form-label">IČO</label>
              <input class="form-control" name="ico">
            </div>
            <div class="col-md-2">
              <label class="form-label">DIČ</label>
              <input class="form-control" name="dic">
            </div>
            <div class="col-md-2">
              <label class="form-label">IČ DPH</label>
              <input class="form-control" name="ic_dph">
            </div>
            <div class="col-md-2">
              <label class="form-label">Skupina</label>
              <input class="form-control" name="group_code">
            </div>
            <div class="col-md-2">
              <label class="form-label">Cenová hladina</label>
              <input class="form-control" name="price_level">
            </div>
            <div class="col-md-2">
              <label class="form-label">Zľava %</label>
              <input class="form-control" name="discount_percent" type="number" step="0.1">
            </div>
            <div class="col-md-8">
              <label class="form-label">Poznámka</label>
              <input class="form-control" name="note">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zavrieť</button>
          <button type="submit" class="btn btn-primary">Uložiť partnera</button>
        </div>
      </form>
    </div>
  </div>
</div>
<table class="table table-striped bg-white shadow-sm">
  <thead>
    <tr class="table-filter">
      <th><input type="text" class="form-control form-control-sm" data-col="0" placeholder="Názov..."></th>
      <th><input type="text" class="form-control form-control-sm" data-col="1" placeholder="Adresa..."></th>
      <th><input type="text" class="form-control form-control-sm" data-col="2" placeholder="IČO..."></th>
      <th><input type="text" class="form-control form-control-sm" data-col="3" placeholder="DIČ..."></th>
      <th><input type="text" class="form-control form-control-sm" data-col="4" placeholder="IČ DPH..."></th>
      <th><input type="text" class="form-control form-control-sm" data-col="5" placeholder="Skupina..."></th>
      <th><input type="text" class="form-control form-control-sm" data-col="6" placeholder="Cena/Zľava..."></th>
      <th><input type="text" class="form-control form-control-sm" data-col="7" placeholder="Kontakty..."></th>
      <th><input type="text" class="form-control form-control-sm" data-col="8" placeholder="Adresy..."></th>
    </tr>
    <tr>
      <th>Názov</th>
      <th>Adresa</th>
      <th>IČO</th>
      <th>DIČ</th>
      <th>IČ DPH</th>
      <th>Skupina</th>
      <th>Cena/Zľava</th>
      <th>Kontakty</th>
      <th>Adresy</th>
    </tr>
  </thead>
  <tbody>
    {% for partner in partners %}
    <tr>
      <td>{{ partner.name }}</td>
      <td>
        {{ partner.street }} {{ partner.street_number }}<br>
        {{ partner.postal_code }} {{ partner.city }}<br>
        {{ partner.email }} / {{ partner.phone }}
      </td>
      <td>{{ partner.ico }}</td>
      <td>{{ partner.dic }}</td>
      <td>{{ partner.ic_dph }}</td>
      <td>{{ partner.group_code }}</td>
      <td>{{ partner.price_level }} / {{ partner.discount_percent }} %</td>
      <td>
        <ul class="list-unstyled mb-2">
          {% for contact in partner.contacts %}
          <li>
            <strong>{{ contact.name }}</strong> ({{ contact.role }})<br>
            {{ contact.email }} / {{ contact.phone }}
          </li>
          {% endfor %}
        </ul>
        <form method="post" action="{{ url_for('partners.add_contact', partner_id=partner.id) }}" class="row g-2">
          <div class="col-6"><input class="form-control form-control-sm" name="name" placeholder="Meno" required></div>
          <div class="col-6"><input class="form-control form-control-sm" name="role" placeholder="Rola"></div>
          <div class="col-6"><input class="form-control form-control-sm" name="email" placeholder="Email"></div>
          <div class="col-6"><input class="form-control form-control-sm" name="phone" placeholder="Telefón"></div>
          <div class="col-12">
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" name="can_order" id="can_order_{{ partner.id }}">
              <label class="form-check-label" for="can_order_{{ partner.id }}">Objednáva</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" name="can_receive" id="can_receive_{{ partner.id }}">
              <label class="form-check-label" for="can_receive_{{ partner.id }}">Preberá</label>
            </div>
          </div>
          <div class="col-12"><button class="btn btn-sm btn-outline-primary" type="submit">Pridať kontakt</button></div>
        </form>
      </td>
      <td>
        <ul class="list-unstyled mb-2">
          {% for address in partner.addresses %}
          <li>
            <strong>{{ address.address_type }}</strong>
            {% if address.related_partner %}
              ({{ address.related_partner.name }})
            {% endif %}
            <br>
            {{ address.street }} {{ address.street_number }}, {{ address.postal_code }} {{ address.city }}
          </li>
          {% endfor %}
        </ul>
        <form method="post" action="{{ url_for('partners.add_address', partner_id=partner.id) }}" class="row g-2">
          <div class="col-6">
            <select class="form-select form-select-sm" name="address_type">
              <option value="headquarters">Sídlo</option>
              <option value="ordering">Objednávacia</option>
              <option value="delivery">Dodacia</option>
              <option value="invoice">Fakturačná</option>
              <option value="other">Iná</option>
            </select>
          </div>
          <div class="col-6">
            <input class="form-control form-control-sm" name="related_partner_id" placeholder="ID partnera (voliteľné)">
          </div>
          <div class="col-6"><input class="form-control form-control-sm" name="street" placeholder="Ulica"></div>
          <div class="col-3"><input class="form-control form-control-sm" name="street_number" placeholder="Číslo"></div>
          <div class="col-3"><input class="form-control form-control-sm" name="postal_code" placeholder="PSČ"></div>
          <div class="col-6"><input class="form-control form-control-sm" name="city" placeholder="Mesto"></div>
          <div class="col-12"><button class="btn btn-sm btn-outline-primary" type="submit">Pridať adresu</button></div>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
