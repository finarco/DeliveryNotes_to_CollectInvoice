{# Sidebar Component #}
<aside class="sidebar">
  <div class="sidebar-top">
    {# Logo Section #}
    <div class="sidebar-logo">
      <div class="logo-icon">D</div>
      <div class="logo-text">DeliveryNotes</div>
    </div>

    {# Tenant Switcher #}
    {% if current_tenant %}
    <div class="tenant-switcher">
      {% if user_tenants and user_tenants|length > 1 %}
      <form method="post" action="{{ url_for('tenant.switch_tenant') }}" class="tenant-switcher-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="tenant-switcher-select">
          <i data-lucide="building-2" class="tenant-switcher-icon"></i>
          <div class="tenant-switcher-info">
            <select name="tenant_id" onchange="this.form.submit()" class="tenant-select">
              {% for ut in user_tenants %}
              <option value="{{ ut.tenant_id }}" {% if ut.tenant_id == current_tenant.id %}selected{% endif %}>
                {{ ut.tenant.name }}
              </option>
              {% endfor %}
            </select>
            {% if current_tenant.ico %}
            <span class="tenant-ico">{{ current_tenant.ico }}</span>
            {% endif %}
          </div>
          <i data-lucide="chevrons-up-down" class="tenant-switcher-chevron"></i>
        </div>
      </form>
      {% else %}
      <div class="tenant-switcher-select">
        <i data-lucide="building-2" class="tenant-switcher-icon"></i>
        <div class="tenant-switcher-info">
          <span class="tenant-name">{{ current_tenant.name }}</span>
          {% if current_tenant.ico %}
          <span class="tenant-ico">{{ current_tenant.ico }}</span>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>
    {% endif %}

    {# Navigation #}
    <nav>
      <ul class="sidebar-nav">
        <li class="sidebar-nav-item">
          <a href="{{ url_for('dashboard.index') }}" class="sidebar-nav-link {% if request.endpoint and request.endpoint == 'dashboard.index' %}active{% endif %}">
            <i data-lucide="layout-dashboard" class="sidebar-nav-icon"></i>
            <span>Prehľad</span>
          </a>
        </li>

        {% if "manage_all" in user_permissions or "manage_partners" in user_permissions %}
        <li class="sidebar-nav-item">
          <a href="{{ url_for('partners.list_partners') }}" class="sidebar-nav-link {% if request.endpoint and 'partners' in request.endpoint %}active{% endif %}">
            <i data-lucide="users" class="sidebar-nav-icon"></i>
            <span>Partneri</span>
          </a>
        </li>
        {% endif %}

        {% if "manage_all" in user_permissions or "manage_orders" in user_permissions %}
        <li class="sidebar-nav-item">
          <a href="{{ url_for('orders.list_orders') }}" class="sidebar-nav-link {% if request.endpoint and 'orders' in request.endpoint %}active{% endif %}">
            <i data-lucide="file-text" class="sidebar-nav-icon"></i>
            <span>Objednávky</span>
          </a>
        </li>

        <li class="sidebar-nav-item">
          <a href="{{ url_for('products.list_products') }}" class="sidebar-nav-link {% if request.endpoint and request.endpoint == 'products.list_products' %}active{% endif %}">
            <i data-lucide="package" class="sidebar-nav-icon"></i>
            <span>Produkty</span>
          </a>
        </li>

        <li class="sidebar-nav-item">
          <a href="{{ url_for('products.list_bundles') }}" class="sidebar-nav-link {% if request.endpoint and request.endpoint == 'products.list_bundles' %}active{% endif %}">
            <i data-lucide="layers" class="sidebar-nav-icon"></i>
            <span>Kombinácie</span>
          </a>
        </li>
        {% endif %}

        {% if "manage_all" in user_permissions or "manage_delivery" in user_permissions %}
        <li class="sidebar-nav-item">
          <a href="{{ url_for('delivery.list_delivery_notes') }}" class="sidebar-nav-link {% if request.endpoint and 'delivery' in request.endpoint %}active{% endif %}">
            <i data-lucide="truck" class="sidebar-nav-icon"></i>
            <span>Dodacie listy</span>
          </a>
        </li>
        {% endif %}

        {% if "manage_all" in user_permissions or "manage_invoices" in user_permissions %}
        <li class="sidebar-nav-item">
          <a href="{{ url_for('invoices.list_invoices') }}" class="sidebar-nav-link {% if request.endpoint and 'invoices' in request.endpoint %}active{% endif %}">
            <i data-lucide="receipt" class="sidebar-nav-icon"></i>
            <span>Faktúry</span>
          </a>
        </li>
        {% endif %}

        {% if "manage_all" in user_permissions %}
        <li class="sidebar-nav-item">
          <a href="{{ url_for('db_tools.index') }}" class="sidebar-nav-link {% if request.endpoint and 'db_tools' in request.endpoint %}active{% endif %}">
            <i data-lucide="database" class="sidebar-nav-icon"></i>
            <span>DB Tools</span>
          </a>
        </li>

        <li class="sidebar-nav-item">
          <a href="{{ url_for('admin.users') }}" class="sidebar-nav-link {% if request.endpoint and 'admin' in request.endpoint and request.endpoint != 'admin.superadmin_dashboard' %}active{% endif %}">
            <i data-lucide="settings" class="sidebar-nav-icon"></i>
            <span>Administrácia</span>
          </a>
        </li>
        {% endif %}

        {% if current_user and current_user.is_superadmin %}
        <li class="sidebar-nav-item">
          <a href="{{ url_for('admin.superadmin_dashboard') }}" class="sidebar-nav-link {% if request.endpoint and request.endpoint == 'admin.superadmin_dashboard' %}active{% endif %}">
            <i data-lucide="shield" class="sidebar-nav-icon"></i>
            <span>Superadmin</span>
          </a>
        </li>
        {% endif %}
      </ul>
    </nav>
  </div>

  {# Bottom Section #}
  <div class="sidebar-bottom">
    {# Upgrade Box #}
    <div class="upgrade-box">
      <div class="upgrade-box-title">UPGRADE NA PRO</div>
      <div class="upgrade-box-text">Získajte rozšírené funkcie, reporty a exporty pre váš biznis.</div>
      <a href="{{ url_for('billing.status') }}" class="btn btn-sm">Začať trial</a>
    </div>

    {# Account Widget #}
    <div class="account-widget">
      <div class="account-avatar">
        {{ current_user.username[0].upper() if current_user else 'U' }}
      </div>
      <div class="account-info">
        <div class="account-name">{{ current_user.username if current_user else 'User' }}</div>
        <div class="account-role">{{ current_user.role|capitalize if current_user else 'User' }}</div>
      </div>
      <button type="button" class="logout-button" title="Odhlásiť" onclick="document.getElementById('logout-form').submit()">
        <i data-lucide="log-out"></i>
      </button>
    </div>
  </div>
</aside>

{# Hidden logout form #}
<form id="logout-form" action="{{ url_for('auth.logout') }}" method="post" style="display: none;">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
</form>
