{% extends "base.html" %}

{% block page_title %}Partneri{% endblock %}

{% block page_actions %}
<div style="display: flex; gap: 12px; align-items: center;">
  {# View Toggle #}
  <div class="view-toggle">
    <button type="button" class="view-toggle-btn active" data-view="table">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="7" height="7"></rect>
        <rect x="14" y="3" width="7" height="7"></rect>
        <rect x="14" y="14" width="7" height="7"></rect>
        <rect x="3" y="14" width="7" height="7"></rect>
      </svg>
      Tabuľka
    </button>
    <button type="button" class="view-toggle-btn" data-view="grid">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="3" y1="9" x2="21" y2="9"></line>
        <line x1="9" y1="21" x2="9" y2="9"></line>
      </svg>
      Karty
    </button>
  </div>
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPartnerModal">
    Pridať partnera
  </button>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/partners.css') }}">
{% endblock %}

{% block content %}

{# Grid View #}
<div class="partner-grid-view">
  <div class="partner-cards-grid">
    {% for partner in partners %}
    <div class="partner-card" data-partner-id="{{ partner.id }}">
      <div class="partner-card-header">
        <h3 class="partner-card-name">{{ partner.name }}</h3>
        <div class="partner-card-status">
          {% if partner.is_active %}
            <span class="badge badge-success">Aktívny</span>
          {% else %}
            <span class="badge badge-secondary" style="background: #888;">Neaktívny</span>
          {% endif %}
        </div>
      </div>

      <div class="partner-card-info">
        {% if partner.street or partner.city %}
        <div class="partner-card-info-row">
          <svg class="partner-card-info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
          <span>{{ partner.street }} {{ partner.street_number }}, {{ partner.postal_code }} {{ partner.city }}</span>
        </div>
        {% endif %}

        {% if partner.email %}
        <div class="partner-card-info-row">
          <svg class="partner-card-info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
          <span>{{ partner.email }}</span>
        </div>
        {% endif %}

        {% if partner.phone %}
        <div class="partner-card-info-row">
          <svg class="partner-card-info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
          </svg>
          <span>{{ partner.phone }}</span>
        </div>
        {% endif %}
      </div>

      <div class="partner-card-divider"></div>

      <div class="partner-card-meta">
        {% if partner.ico %}
        <div class="partner-card-meta-item">
          <strong>IČO:</strong> {{ partner.ico }}
        </div>
        {% endif %}
        {% if partner.dic %}
        <div class="partner-card-meta-item">
          <strong>DIČ:</strong> {{ partner.dic }}
        </div>
        {% endif %}
        {% if partner.group_code %}
        <div class="partner-card-meta-item">
          <strong>Skupina:</strong> {{ partner.group_code }}
        </div>
        {% endif %}
        {% if partner.discount_percent %}
        <div class="partner-card-meta-item">
          <strong>Zľava:</strong> {{ partner.discount_percent }}%
        </div>
        {% endif %}
      </div>

      <div class="partner-card-actions">
        <button type="button" class="btn btn-outline btn-sm"
          data-bs-toggle="modal" data-bs-target="#viewPartnerModal"
          data-name="{{ partner.name or '' }}"
          data-note="{{ partner.note or '' }}"
          data-email="{{ partner.email or '' }}"
          data-phone="{{ partner.phone or '' }}"
          data-street="{{ partner.street or '' }}"
          data-street-number="{{ partner.street_number or '' }}"
          data-postal-code="{{ partner.postal_code or '' }}"
          data-city="{{ partner.city or '' }}"
          data-ico="{{ partner.ico or '' }}"
          data-dic="{{ partner.dic or '' }}"
          data-ic-dph="{{ partner.ic_dph or '' }}"
          data-group-code="{{ partner.group_code or '' }}"
          data-price-level="{{ partner.price_level or '' }}"
          data-discount-percent="{{ partner.discount_percent }}"
          data-is-active="{{ 1 if partner.is_active else 0 }}">
          Zobraziť
        </button>
        <button type="button" class="btn btn-primary btn-sm"
          data-bs-toggle="modal" data-bs-target="#editPartnerModal"
          data-id="{{ partner.id }}"
          data-name="{{ partner.name or '' }}"
          data-email="{{ partner.email or '' }}"
          data-phone="{{ partner.phone or '' }}"
          data-street="{{ partner.street or '' }}"
          data-street-number="{{ partner.street_number or '' }}"
          data-postal-code="{{ partner.postal_code or '' }}"
          data-city="{{ partner.city or '' }}"
          data-ico="{{ partner.ico or '' }}"
          data-dic="{{ partner.dic or '' }}"
          data-ic-dph="{{ partner.ic_dph or '' }}"
          data-group-code="{{ partner.group_code or '' }}"
          data-price-level="{{ partner.price_level or '' }}"
          data-discount-percent="{{ partner.discount_percent }}"
          data-note="{{ partner.note or '' }}">
          Upraviť
        </button>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

{# Table View #}
<div class="partner-table-view">
  <div class="card">
    <table class="table">
      <thead>
        <tr class="table-filter">
          <th></th>
          <th><input type="text" class="form-control form-control-sm" data-col="1" placeholder="Názov..."></th>
          <th><input type="text" class="form-control form-control-sm" data-col="2" placeholder="Adresa..."></th>
          <th><input type="text" class="form-control form-control-sm" data-col="3" placeholder="IČO..."></th>
          <th><input type="text" class="form-control form-control-sm" data-col="4" placeholder="DIČ..."></th>
          <th><input type="text" class="form-control form-control-sm" data-col="5" placeholder="Skupina..."></th>
          <th><input type="text" class="form-control form-control-sm" data-col="6" placeholder="Kontakty..."></th>
        </tr>
        <tr>
          <th>Akcie</th>
          <th>Názov</th>
          <th>Adresa</th>
          <th>IČO / DIČ</th>
          <th>IČ DPH</th>
          <th>Skupina</th>
          <th>Kontakty</th>
        </tr>
      </thead>
      <tbody>
        {% for partner in partners %}
        <tr>
          <td class="actions-col">
            <button type="button" class="btn btn-sm btn-outline-info"
              data-bs-toggle="modal" data-bs-target="#viewPartnerModal"
              data-name="{{ partner.name or '' }}"
              data-note="{{ partner.note or '' }}"
              data-email="{{ partner.email or '' }}"
              data-phone="{{ partner.phone or '' }}"
              data-street="{{ partner.street or '' }}"
              data-street-number="{{ partner.street_number or '' }}"
              data-postal-code="{{ partner.postal_code or '' }}"
              data-city="{{ partner.city or '' }}"
              data-ico="{{ partner.ico or '' }}"
              data-dic="{{ partner.dic or '' }}"
              data-ic-dph="{{ partner.ic_dph or '' }}"
              data-group-code="{{ partner.group_code or '' }}"
              data-price-level="{{ partner.price_level or '' }}"
              data-discount-percent="{{ partner.discount_percent }}"
              data-is-active="{{ 1 if partner.is_active else 0 }}">Zobraziť</button>
            {% if not partner.is_active %}
            <span class="badge bg-secondary">Neaktívny</span>
            {% endif %}
            <form method="post" action="{{ url_for('partners.toggle_partner', partner_id=partner.id) }}">
              {% if partner.is_active %}
                <button class="btn btn-sm btn-outline-warning" type="submit">Deaktivovať</button>
              {% else %}
                <button class="btn btn-sm btn-outline-success" type="submit">Aktivovať</button>
              {% endif %}
            </form>
            <button type="button" class="btn btn-sm btn-outline-primary"
              data-bs-toggle="modal" data-bs-target="#editPartnerModal"
              data-id="{{ partner.id }}"
              data-name="{{ partner.name or '' }}"
              data-email="{{ partner.email or '' }}"
              data-phone="{{ partner.phone or '' }}"
              data-street="{{ partner.street or '' }}"
              data-street-number="{{ partner.street_number or '' }}"
              data-postal-code="{{ partner.postal_code or '' }}"
              data-city="{{ partner.city or '' }}"
              data-ico="{{ partner.ico or '' }}"
              data-dic="{{ partner.dic or '' }}"
              data-ic-dph="{{ partner.ic_dph or '' }}"
              data-group-code="{{ partner.group_code or '' }}"
              data-price-level="{{ partner.price_level or '' }}"
              data-discount-percent="{{ partner.discount_percent }}"
              data-note="{{ partner.note or '' }}">Upraviť</button>
            <form method="post" action="{{ url_for('partners.delete_partner', partner_id=partner.id) }}"
                  onsubmit="return confirm('Naozaj chcete vymazať tohto partnera?')">
              <button class="btn btn-sm btn-outline-danger" type="submit">Vymazať</button>
            </form>
          </td>
          <td>{{ partner.name }}</td>
          <td>
            {{ partner.street }} {{ partner.street_number }}<br>
            {{ partner.postal_code }} {{ partner.city }}
          </td>
          <td>{{ partner.ico }} / {{ partner.dic }}</td>
          <td>{{ partner.ic_dph }}</td>
          <td>{{ partner.group_code }}</td>
          <td>
            {{ partner.email }}<br>
            {{ partner.phone }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{# Keep all existing modals (addPartnerModal, editPartnerModal, viewPartnerModal, etc.) #}
{# [Previous modal code remains unchanged - just shortened here for brevity] #}

{% endblock %}

{% block extra_js %}
<script>
// View toggle functionality
document.querySelectorAll('.view-toggle-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    const view = this.dataset.view;

    // Update active state
    document.querySelectorAll('.view-toggle-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');

    // Toggle views
    if (view === 'grid') {
      document.body.classList.add('grid-view');
      localStorage.setItem('partnersView', 'grid');
    } else {
      document.body.classList.remove('grid-view');
      localStorage.setItem('partnersView', 'table');
    }
  });
});

// Restore saved view preference
const savedView = localStorage.getItem('partnersView');
if (savedView === 'grid') {
  document.body.classList.add('grid-view');
  document.querySelector('.view-toggle-btn[data-view="grid"]').classList.add('active');
  document.querySelector('.view-toggle-btn[data-view="table"]').classList.remove('active');
}
</script>
{% endblock %}
