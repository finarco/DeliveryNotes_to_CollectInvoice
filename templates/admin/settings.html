{% extends "base.html" %}
{% block content %}
<h4 class="mb-3">Nastavenia</h4>
<form method="post">
  {# ── General ──────────────────────────────────────────────── #}
  <div class="card mb-4">
    <div class="card-header"><strong>Všeobecné</strong></div>
    <div class="card-body row g-3">
      <div class="col-md-6">
        <label class="form-label">Názov stránky</label>
        <input class="form-control" name="site_name" value="{{ site_name }}">
      </div>
    </div>
  </div>

  {# ── Password policy ─────────────────────────────────────── #}
  <div class="card mb-4">
    <div class="card-header"><strong>Bezpečnosť — expirácia hesla</strong></div>
    <div class="card-body row g-3">
      <div class="col-md-4">
        <label class="form-label">Platnosť hesla</label>
        <input class="form-control" type="number" min="0"
               name="password_expiry_value" value="{{ password_expiry_value }}">
        <small class="text-muted">0 = bez expirácie</small>
      </div>
      <div class="col-md-4">
        <label class="form-label">Jednotka</label>
        <select class="form-select" name="password_expiry_unit">
          <option value="days"{% if password_expiry_unit == 'days' %} selected{% endif %}>Dni</option>
          <option value="weeks"{% if password_expiry_unit == 'weeks' %} selected{% endif %}>Týždne</option>
          <option value="months"{% if password_expiry_unit == 'months' %} selected{% endif %}>Mesiace</option>
        </select>
      </div>
    </div>
  </div>

  {# ── Numbering ────────────────────────────────────────────── #}
  <div class="card mb-4">
    <div class="card-header"><strong>Číslovanie dokladov</strong></div>
    <div class="card-body">
      {% set labels = {'product':'Produkty','bundle':'Kombinácie','order':'Objednávky','delivery_note':'Dodacie listy','invoice':'Faktúry'} %}
      {% set product_types = ['product','bundle'] %}
      {% set doc_types = ['order','delivery_note','invoice'] %}

      {% for etype in entity_types %}
      {% set cfg = numbering.get(etype) %}
      <fieldset class="border rounded p-3 mb-3">
        <legend class="float-none w-auto px-2 fs-6 fw-bold">{{ labels[etype] }}</legend>
        <div class="row g-3">
          <div class="col-md-3">
            <label class="form-label">Prefix</label>
            <input class="form-control form-control-sm" name="num_{{ etype }}_prefix"
                   value="{{ cfg.prefix if cfg else '' }}" placeholder="napr. PRD">
          </div>
          <div class="col-md-2">
            <label class="form-label">Oddeľovač</label>
            <input class="form-control form-control-sm" name="num_{{ etype }}_separator"
                   value="{{ cfg.separator if cfg else '-' }}" maxlength="5">
          </div>
          <div class="col-md-2">
            <label class="form-label">Počet číslic</label>
            <input class="form-control form-control-sm" type="number" min="1" max="10"
                   name="num_{{ etype }}_digits"
                   value="{{ cfg.sequence_digits if cfg else 4 }}">
          </div>

          {% if etype in product_types %}
          <div class="col-md-5">
            <div class="form-check mt-4">
              <input class="form-check-input" type="checkbox" name="num_{{ etype }}_type_indicator"
                     id="num_{{ etype }}_type_indicator"
                     {{ 'checked' if cfg and cfg.include_type_indicator else '' }}>
              <label class="form-check-label" for="num_{{ etype }}_type_indicator">Indikátor typu (tovar/služba)</label>
            </div>
            <div class="row g-2 mt-1">
              <div class="col">
                <input class="form-control form-control-sm" name="num_{{ etype }}_goods_ind"
                       value="{{ cfg.goods_indicator if cfg else 'T' }}" placeholder="Tovar (T)">
                <small class="text-muted">Tovar</small>
              </div>
              <div class="col">
                <input class="form-control form-control-sm" name="num_{{ etype }}_service_ind"
                       value="{{ cfg.service_indicator if cfg else 'S' }}" placeholder="Služba (S)">
                <small class="text-muted">Služba</small>
              </div>
            </div>
          </div>
          {% endif %}

          {% if etype in doc_types %}
          <div class="col-md-5">
            <label class="form-label">Komponenty čísla</label>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="num_{{ etype }}_partner_id"
                     id="num_{{ etype }}_partner_id"
                     {{ 'checked' if cfg and cfg.include_partner_id else '' }}>
              <label class="form-check-label" for="num_{{ etype }}_partner_id">ID partnera</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="num_{{ etype }}_year"
                     id="num_{{ etype }}_year"
                     {{ 'checked' if cfg and cfg.include_year else '' }}>
              <label class="form-check-label" for="num_{{ etype }}_year">Rok</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="num_{{ etype }}_month"
                     id="num_{{ etype }}_month"
                     {{ 'checked' if cfg and cfg.include_month else '' }}>
              <label class="form-check-label" for="num_{{ etype }}_month">Mesiac</label>
            </div>
          </div>
          {% endif %}
        </div>
      </fieldset>
      {% endfor %}
    </div>
  </div>

  <button type="submit" class="btn btn-primary mb-4">Uložiť nastavenia</button>
</form>
{% endblock %}
