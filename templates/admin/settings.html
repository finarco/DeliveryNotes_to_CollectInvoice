{% extends "base.html" %}
{% block content %}
<h4 class="mb-3">Nastavenia</h4>
<form method="post">
  {# ── General ──────────────────────────────────────────────── #}
  <div class="card mb-4">
    <div class="card-header"><strong>Všeobecné</strong></div>
    <div class="card-body row g-3">
      <div class="col-md-6">
        <label class="form-label">Názov stránky</label>
        <input class="form-control" name="site_name" value="{{ site_name }}">
      </div>
    </div>
  </div>

  {# ── Password policy ─────────────────────────────────────── #}
  <div class="card mb-4">
    <div class="card-header"><strong>Bezpečnosť — expirácia hesla</strong></div>
    <div class="card-body row g-3">
      <div class="col-md-4">
        <label class="form-label">Platnosť hesla</label>
        <input class="form-control" type="number" min="0"
               name="password_expiry_value" value="{{ password_expiry_value }}">
        <small class="text-muted">0 = bez expirácie</small>
      </div>
      <div class="col-md-4">
        <label class="form-label">Jednotka</label>
        <select class="form-select" name="password_expiry_unit">
          <option value="days"{% if password_expiry_unit == 'days' %} selected{% endif %}>Dni</option>
          <option value="weeks"{% if password_expiry_unit == 'weeks' %} selected{% endif %}>Týždne</option>
          <option value="months"{% if password_expiry_unit == 'months' %} selected{% endif %}>Mesiace</option>
        </select>
      </div>
    </div>
  </div>

  {# ── Numbering (tag-based) ─────────────────────────────── #}
  <div class="card mb-4">
    <div class="card-header"><strong>Číslovanie dokladov</strong></div>
    <div class="card-body">
      <p class="text-muted small mb-3">
        Dostupné tagy:
        <code>[YYYY]</code> rok (4-ciferný),
        <code>[YY]</code> rok (2-ciferný),
        <code>[MM]</code> mesiac,
        <code>[DD]</code> deň,
        <code>[PARTNER]</code> ID partnera,
        <code>[TYPE]</code> typ (T=tovar, S=služba),
        <code>[C...]</code> sekvenčné číslo (počet C = počet číslic, napr. <code>[CCCC]</code> = 4 číslice).<br>
        Text mimo hranatých zátvoriek je fixný. Číslovanie sa resetuje pri zmene predchádzajúcich tagov.<br>
        Príklad: <code>DL[YY][MM]-[CCCC]</code> &rarr; <code>DL2601-0001</code>
      </p>
      {% set labels = {'product':'Produkty','bundle':'Kombinácie','order':'Objednávky','delivery_note':'Dodacie listy','invoice':'Faktúry'} %}
      {% set examples = {'product':'PRD[TYPE]-[CCCC]','bundle':'KMB-[CCCC]','order':'OBJ[YY][MM]-[CCCC]','delivery_note':'DL[YY][MM]-[CCCC]','invoice':'FV[YYYY]-[PARTNER]-[CCCC]'} %}
      {% for etype in entity_types %}
      {% set cfg = numbering.get(etype) %}
      <div class="row g-3 mb-3 align-items-center">
        <div class="col-md-3">
          <label class="form-label fw-bold mb-0">{{ labels[etype] }}</label>
        </div>
        <div class="col-md-9">
          <input class="form-control" name="num_{{ etype }}_pattern"
                 value="{{ cfg.pattern if cfg and cfg.pattern else '' }}"
                 placeholder="napr. {{ examples[etype] }}">
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <button type="submit" class="btn btn-primary mb-4">Uložiť nastavenia</button>
</form>
{% endblock %}
