{% extends "base.html" %}

{% block page_title %}Prehľad{% endblock %}

{% block page_subtitle %}
<div class="page-subtitle">Sledujte aktivitu vášho podnikania</div>
{% endblock %}

{% block page_actions %}
<div style="display: flex; gap: 12px; align-items: center;">
  <div style="position: relative;">
    <input type="text" class="form-control" placeholder="Hľadať..." style="width: 200px; padding-right: 32px;">
  </div>
  <a href="{{ url_for('orders.list_orders') }}" class="btn btn-primary">Nová objednávka</a>
</div>
{% endblock %}

{% block content %}
{# Metrics Grid #}
<div class="metrics-grid">
  <div class="card">
    <div class="card-title">Partneri</div>
    <div class="card-value">{{ partner_count }}</div>
    <div class="card-change positive">
      <span>+{{ partner_change|default(0) }}%</span> tento mesiac
    </div>
  </div>

  <div class="card">
    <div class="card-title">Objednávky</div>
    <div class="card-value">{{ order_count }}</div>
    <div class="card-change positive">
      <span>+{{ order_change|default(0) }}%</span> tento mesiac
    </div>
  </div>

  <div class="card">
    <div class="card-title">Dodacie listy</div>
    <div class="card-value">{{ delivery_count }}</div>
    <div class="card-change positive">
      <span>+{{ delivery_change|default(0) }}%</span> tento mesiac
    </div>
  </div>

  <div class="card">
    <div class="card-title">Faktúry</div>
    <div class="card-value">{{ invoice_count }}</div>
    <div class="card-change positive">
      <span>+{{ invoice_change|default(0) }}%</span> tento mesiac
    </div>
  </div>
</div>

{# Quick Actions - Mobile Only #}
<div class="quick-actions">
  <h3 class="card-title" style="margin-bottom: 16px;">Rýchle akcie</h3>
  <div class="quick-actions-grid">
    <a href="{{ url_for('orders.list_orders') }}" class="quick-action-btn">
      <svg class="quick-action-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="12" y1="18" x2="12" y2="12"></line>
        <line x1="9" y1="15" x2="15" y2="15"></line>
      </svg>
      Nová objednávka
    </a>
    <a href="{{ url_for('partners.list_partners') }}" class="quick-action-btn">
      <svg class="quick-action-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="8.5" cy="7" r="4"></circle>
        <line x1="20" y1="8" x2="20" y2="14"></line>
        <line x1="23" y1="11" x2="17" y2="11"></line>
      </svg>
      Pridať partnera
    </a>
    <a href="{{ url_for('invoices.list_invoices') }}" class="quick-action-btn">
      <svg class="quick-action-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1z"></path>
        <path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"></path>
      </svg>
      Vytvoriť faktúru
    </a>
  </div>
</div>

{# Recent Activity Section #}
{% if recent_activity %}
<div class="two-column-grid">
  {# Transactions table (left side) #}
  <div class="card">
    <h3 class="card-title">Najnovšie transakcie</h3>

    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>Dátum</th>
            <th>Partner</th>
            <th>Typ</th>
            <th>Suma</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for item in recent_activity %}
          <tr>
            <td>{{ item.date.strftime('%d.%m.%Y') if item.date else '-' }}</td>
            <td>{{ item.partner_name }}</td>
            <td>{{ item.type }}</td>
            <td>{{ "%.2f"|format(item.amount) }} &euro;</td>
            <td>
              <span class="badge badge-{{ item.status_class }}">
                {{ item.status }}
              </span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {# Activity Feed (right side) #}
  <div class="card card-dark">
    <h3 class="card-title">Nedávna aktivita</h3>

    <div class="activity-feed">
      {% for activity in recent_changes %}
      <div class="activity-feed-item">
        <span class="status-dot {{ activity.type }}"></span>
        <div class="activity-feed-content">
          <div class="activity-feed-title">
            {{ activity.title }}
          </div>
          <div class="activity-feed-desc">
            {{ activity.description }}
          </div>
          <div class="activity-feed-time">
            {{ activity.time }}
          </div>
        </div>
        <span class="badge badge-{{ activity.badge_class }}">
          {{ activity.status }}
        </span>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}
{% endblock %}

{% block extra_css %}
<style>
  .activity-feed {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  .activity-feed-item {
    display: flex;
    gap: 12px;
  }
  .activity-feed-content {
    flex: 1;
  }
  .activity-feed-title {
    font-size: 14px;
    font-weight: 500;
    color: #fff;
    margin-bottom: 4px;
  }
  .activity-feed-desc {
    font-size: 12px;
    color: #888;
  }
  .activity-feed-time {
    font-size: 10px;
    color: #666;
    margin-top: 8px;
  }
</style>
{% endblock %}
