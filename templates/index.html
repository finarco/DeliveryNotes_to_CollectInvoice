{% extends "base.html" %}

{% block page_title %}Prehľad{% endblock %}

{% block page_subtitle %}
<div class="page-subtitle">Sledujte aktivitu vášho podnikania</div>
{% endblock %}

{% block page_actions %}
<div style="display: flex; gap: 12px; align-items: center;">
  <div style="position: relative;">
    <input type="text" class="form-control" placeholder="Hľadať..." style="width: 200px; padding-right: 32px;">
    <i data-lucide="search" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; color: var(--color-text-muted);"></i>
  </div>
  <button type="button" class="btn btn-outline" onclick="window.print()">
    <i data-lucide="download" style="width: 16px; height: 16px;"></i> Export
  </button>
  <a href="{{ url_for('orders.list_orders') }}" class="btn btn-primary">Nová objednávka</a>
</div>
{% endblock %}

{% block content %}
{# Metrics Grid #}
<div class="metrics-grid">
  <div class="card">
    <div class="card-title">Partneri</div>
    <div class="card-value">{{ partner_count }}</div>
    <div class="card-change positive">
      <span>+{{ partner_change|default(0) }}%</span> tento mesiac
    </div>
  </div>

  <div class="card">
    <div class="card-title">Objednávky</div>
    <div class="card-value">{{ order_count }}</div>
    <div class="card-change positive">
      <span>+{{ order_change|default(0) }}%</span> tento mesiac
    </div>
  </div>

  <div class="card">
    <div class="card-title">Dodacie listy</div>
    <div class="card-value">{{ delivery_count }}</div>
    <div class="card-change positive">
      <span>+{{ delivery_change|default(0) }}%</span> tento mesiac
    </div>
  </div>

  <div class="card">
    <div class="card-title">Faktúry</div>
    <div class="card-value">{{ invoice_count }}</div>
    <div class="card-change positive">
      <span>+{{ invoice_change|default(0) }}%</span> tento mesiac
    </div>
  </div>
</div>

{# Quick Actions - Mobile Only #}
<div class="quick-actions">
  <h3 class="card-title" style="margin-bottom: 16px;">Rýchle akcie</h3>
  <div class="quick-actions-grid">
    <a href="{{ url_for('orders.list_orders') }}" class="quick-action-btn">
      <i data-lucide="file-plus" class="quick-action-icon"></i>
      Nová objednávka
    </a>
    <a href="{{ url_for('partners.list_partners') }}" class="quick-action-btn">
      <i data-lucide="user-plus" class="quick-action-icon"></i>
      Pridať partnera
    </a>
    <a href="{{ url_for('invoices.list_invoices') }}" class="quick-action-btn">
      <i data-lucide="receipt" class="quick-action-icon"></i>
      Vytvoriť faktúru
    </a>
  </div>
</div>

{# Recent Activity Section #}
{% if recent_activity %}
<div class="two-column-grid">
  {# Transactions table (left side) #}
  <div class="card">
    <h3 class="card-title">Najnovšie transakcie</h3>

    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>Dátum</th>
            <th>Partner</th>
            <th>Typ</th>
            <th>Suma</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for item in recent_activity %}
          <tr>
            <td>{{ item.date.strftime('%d.%m.%Y') if item.date else '-' }}</td>
            <td>{{ item.partner_name }}</td>
            <td>{{ item.type }}</td>
            <td>{{ "%.2f"|format(item.amount) }} &euro;</td>
            <td>
              <span class="badge badge-{{ item.status_class }}">
                {{ item.status }}
              </span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {# Activity Feed (right side) #}
  <div class="card card-dark">
    <h3 class="card-title">Nedávna aktivita</h3>

    <div class="activity-feed">
      {% for activity in recent_changes %}
      <div class="activity-feed-item">
        <span class="status-dot {{ activity.type }}"></span>
        <div class="activity-feed-content">
          <div class="activity-feed-title">
            {{ activity.title }}
          </div>
          <div class="activity-feed-desc">
            {{ activity.description }}
          </div>
          <div class="activity-feed-time">
            {{ activity.time }}
          </div>
        </div>
        <span class="badge badge-{{ activity.badge_class }}">
          {{ activity.status }}
        </span>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}
{% endblock %}

{% block extra_css %}
<style>
  .activity-feed {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  .activity-feed-item {
    display: flex;
    gap: 12px;
  }
  .activity-feed-content {
    flex: 1;
  }
  .activity-feed-title {
    font-size: 14px;
    font-weight: 500;
    color: #fff;
    margin-bottom: 4px;
  }
  .activity-feed-desc {
    font-size: 12px;
    color: #888;
  }
  .activity-feed-time {
    font-size: 10px;
    color: #666;
    margin-top: 8px;
  }
</style>
{% endblock %}
